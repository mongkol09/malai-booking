<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>จำลองการจองห้องพัก - Production Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .booking-card {
            border: 1px solid #dee2e6;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step-indicator {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
        }
        .result-card {
            border-left: 4px solid #28a745;
            background: #f8f9fa;
        }
        .error-card {
            border-left: 4px solid #dc3545;
            background: #fff5f5;
        }
        .loading {
            display: none;
        }
        .loading.show {
            display: block;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="booking-card bg-primary text-white p-4">
                    <h1 class="mb-0">
                        <i class="bi bi-calendar-check me-2"></i>
                        จำลองการจองห้องพัก - Production Test
                    </h1>
                    <p class="mb-0 mt-2">ทดสอบระบบการจองแบบสมบูรณ์เพื่อเช็คความพร้อม Production</p>
                </div>
            </div>
        </div>

        <!-- Booking Form -->
        <div class="row">
            <div class="col-lg-8">
                <div class="booking-card p-4 mb-4">
                    <div class="step-indicator">1</div>
                    <h3 class="text-center mb-4">ข้อมูลการจองห้องพัก</h3>
                    
                    <form id="bookingForm">
                        <!-- Guest Information -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="bi bi-person me-2"></i>ข้อมูลผู้เข้าพัก</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">ชื่อ-นามสกุล *</label>
                                        <input type="text" class="form-control" id="guestName" value="คุณทดสอบ การจอง" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">อีเมล *</label>
                                        <input type="email" class="form-control" id="guestEmail" value="test.booking@example.com" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">เบอร์โทรศัพท์ *</label>
                                        <input type="tel" class="form-control" id="guestPhone" value="081-234-5678" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">สัญชาติ</label>
                                        <select class="form-select" id="nationality">
                                            <option value="Thai" selected>ไทย</option>
                                            <option value="American">อเมริกัน</option>
                                            <option value="Japanese">ญี่ปุ่น</option>
                                            <option value="Chinese">จีน</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Room Information -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="bi bi-house me-2"></i>ข้อมูลห้องพัก</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">ประเภทห้อง *</label>
                                        <select class="form-select" id="roomType" required>
                                            <option value="Onsen" selected>Onsen Room</option>
                                            <option value="Deluxe">Deluxe Room</option>
                                            <option value="Standard">Standard Room</option>
                                            <option value="Suite">Suite Room</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">จำนวนผู้เข้าพัก</label>
                                        <select class="form-select" id="guestCount">
                                            <option value="1">1 ท่าน</option>
                                            <option value="2" selected>2 ท่าน</option>
                                            <option value="3">3 ท่าน</option>
                                            <option value="4">4 ท่าน</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">วันเข้าพัก *</label>
                                        <input type="date" class="form-control" id="checkinDate" value="2025-08-19" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">วันออก *</label>
                                        <input type="date" class="form-control" id="checkoutDate" value="2025-08-20" required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Special Requests -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="bi bi-chat-dots me-2"></i>ความต้องการพิเศษ</h5>
                            </div>
                            <div class="card-body">
                                <textarea class="form-control" id="specialRequests" rows="3" placeholder="ระบุความต้องการพิเศษ (ถ้ามี)">ขอห้องที่เงียบ และขอผ้าเช็ดตัวเพิ่ม</textarea>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg px-5">
                                <i class="bi bi-calendar-check me-2"></i>
                                จำลองการจอง
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Summary & Results -->
            <div class="col-lg-4">
                <div class="booking-card p-4 mb-4">
                    <div class="step-indicator">2</div>
                    <h4 class="text-center mb-3">สรุปการจอง</h4>
                    <div id="bookingSummary">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            กรอกข้อมูลและกดจำลองการจองเพื่อดูผลลัพธ์
                        </div>
                    </div>
                </div>

                <!-- Loading -->
                <div id="loadingCard" class="booking-card p-4 mb-4 loading">
                    <div class="text-center">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">กำลังประมวลผล...</span>
                        </div>
                        <h5>กำลังจำลองการจอง...</h5>
                        <p class="text-muted">กรุณารอสักครู่</p>
                    </div>
                </div>

                <!-- Results -->
                <div id="resultsCard" class="booking-card p-4 loading">
                    <div class="step-indicator">3</div>
                    <h4 class="text-center mb-3">ผลการทดสอบ</h4>
                    <div id="testResults"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE_URL = 'http://localhost:3001/api/v1';

        // Update summary when form changes
        function updateSummary() {
            const guestName = document.getElementById('guestName').value;
            const roomType = document.getElementById('roomType').value;
            const checkinDate = document.getElementById('checkinDate').value;
            const checkoutDate = document.getElementById('checkoutDate').value;
            const guestCount = document.getElementById('guestCount').value;

            const checkin = new Date(checkinDate);
            const checkout = new Date(checkoutDate);
            const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));

            const summary = `
                <div class="card">
                    <div class="card-body">
                        <h6><i class="bi bi-person-fill me-2"></i>ผู้เข้าพัก</h6>
                        <p class="mb-2">${guestName || 'ยังไม่ได้กรอก'}</p>
                        
                        <h6><i class="bi bi-house-fill me-2"></i>ห้องพัก</h6>
                        <p class="mb-2">${roomType} - ${guestCount} ท่าน</p>
                        
                        <h6><i class="bi bi-calendar-fill me-2"></i>วันที่</h6>
                        <p class="mb-2">เข้าพัก: ${checkin.toLocaleDateString('th-TH')}</p>
                        <p class="mb-2">ออก: ${checkout.toLocaleDateString('th-TH')}</p>
                        <p class="mb-0"><strong>${nights} คืน</strong></p>
                    </div>
                </div>
            `;

            document.getElementById('bookingSummary').innerHTML = summary;
        }

        // Simulate booking process
        async function simulateBooking(formData) {
            const steps = [
                { name: 'ตรวจสอบห้องว่าง', delay: 1000 },
                { name: 'สร้างการจอง', delay: 1500 },
                { name: 'ประมวลผลการชำระเงิน', delay: 1200 },
                { name: 'ส่งอีเมลยืนยัน', delay: 800 },
                { name: 'อัพเดทฐานข้อมูล', delay: 600 }
            ];

            const results = [];

            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, step.delay));
                
                // Simulate success/failure
                const success = Math.random() > 0.1; // 90% success rate
                
                results.push({
                    step: step.name,
                    success: success,
                    message: success ? 'สำเร็จ' : 'มีข้อผิดพลาด'
                });

                // Stop if any step fails
                if (!success) break;
            }

            return {
                success: results.every(r => r.success),
                steps: results,
                bookingId: results.every(r => r.success) ? 'BK' + Date.now() : null,
                qrCode: results.every(r => r.success) ? 'QR' + Date.now() : null
            };
        }

        // Form submission
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Show loading
            document.getElementById('loadingCard').classList.add('show');
            document.getElementById('resultsCard').classList.remove('show');

            // Collect form data
            const formData = {
                guest: {
                    name: document.getElementById('guestName').value,
                    email: document.getElementById('guestEmail').value,
                    phone: document.getElementById('guestPhone').value,
                    nationality: document.getElementById('nationality').value
                },
                room: {
                    type: document.getElementById('roomType').value,
                    guests: parseInt(document.getElementById('guestCount').value)
                },
                dates: {
                    checkin: document.getElementById('checkinDate').value,
                    checkout: document.getElementById('checkoutDate').value
                },
                specialRequests: document.getElementById('specialRequests').value
            };

            try {
                // Simulate booking process
                const result = await simulateBooking(formData);

                // Show results
                let resultsHtml = '';

                if (result.success) {
                    resultsHtml = `
                        <div class="result-card p-3 mb-3">
                            <h5 class="text-success mb-3">
                                <i class="bi bi-check-circle-fill me-2"></i>
                                การจองสำเร็จ!
                            </h5>
                            <p><strong>รหัสการจอง:</strong> ${result.bookingId}</p>
                            <p><strong>QR Code:</strong> ${result.qrCode}</p>
                            <p class="mb-0 text-success">✅ ระบบพร้อมใช้งาน Production</p>
                        </div>
                    `;
                } else {
                    resultsHtml = `
                        <div class="error-card p-3 mb-3">
                            <h5 class="text-danger mb-3">
                                <i class="bi bi-x-circle-fill me-2"></i>
                                การจองไม่สำเร็จ
                            </h5>
                            <p class="mb-0 text-danger">❌ ต้องแก้ไขก่อนใช้งาน Production</p>
                        </div>
                    `;
                }

                // Show step details
                resultsHtml += '<div class="mt-3"><h6>รายละเอียดขั้นตอน:</h6><ul class="list-group list-group-flush">';
                
                result.steps.forEach(step => {
                    const iconClass = step.success ? 'bi-check-circle-fill text-success' : 'bi-x-circle-fill text-danger';
                    resultsHtml += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            ${step.step}
                            <span>
                                <i class="bi ${iconClass}"></i>
                                ${step.message}
                            </span>
                        </li>
                    `;
                });

                resultsHtml += '</ul></div>';

                document.getElementById('testResults').innerHTML = resultsHtml;

            } catch (error) {
                document.getElementById('testResults').innerHTML = `
                    <div class="error-card p-3">
                        <h5 class="text-danger mb-3">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            เกิดข้อผิดพลาด
                        </h5>
                        <p class="mb-0">${error.message}</p>
                    </div>
                `;
            } finally {
                // Hide loading and show results
                document.getElementById('loadingCard').classList.remove('show');
                document.getElementById('resultsCard').classList.add('show');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateSummary();
            
            // Update summary on form changes
            ['guestName', 'roomType', 'checkinDate', 'checkoutDate', 'guestCount'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateSummary);
                document.getElementById(id).addEventListener('input', updateSummary);
            });
        });
    </script>
</body>
</html>
