<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #0056b3; }
        .btn-test { background: #28a745; }
        .btn-test:hover { background: #1e7e34; }
        .result { margin-top: 20px; padding: 15px; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .logs { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h1>
        
        <div class="form-group">
            <label>User ID:</label>
            <input type="text" id="userId" value="da670fdb-824c-4595-931b-f77b98c12b15" />
        </div>
        
        <div class="form-group">
            <label>‡∏ä‡∏∑‡πà‡∏≠:</label>
            <input type="text" id="firstName" value="‡∏ó‡∏î‡∏™‡∏≠‡∏ö" />
        </div>
        
        <div class="form-group">
            <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
            <input type="text" id="lastName" value="‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç" />
        </div>
        
        <div class="form-group">
            <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label>
            <input type="email" id="email" value="test@example.com" />
        </div>
        
        <div class="form-group">
            <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</label>
            <input type="text" id="phone" value="0812345678" />
        </div>
        
        <div class="form-group">
            <label>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó:</label>
            <select id="role">
                <option value="customer">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (customer)</option>
                <option value="employee">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (employee)</option>
                <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (admin)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
            <select id="status">
                <option value="active">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (active)</option>
                <option value="inactive">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (inactive)</option>
                <option value="suspended">‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (suspended)</option>
            </select>
        </div>
        
        <button onclick="testUpdateUser()" class="btn-test">üöÄ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button onclick="clearLogs()">üßπ ‡∏•‡πâ‡∏≤‡∏á Logs</button>
        
        <div id="result"></div>
        <div id="logs" class="logs"></div>
    </div>

    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.textContent += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').textContent = '';
            document.getElementById('result').innerHTML = '';
        }

        async function testUpdateUser() {
            const resultDiv = document.getElementById('result');
            
            try {
                const userId = document.getElementById('userId').value;
                const firstName = document.getElementById('firstName').value;
                const lastName = document.getElementById('lastName').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                const role = document.getElementById('role').value;
                const status = document.getElementById('status').value;
                
                const payload = {
                    firstName,
                    lastName,
                    email,
                    phoneNumber: phone,
                    role,
                    status
                };
                
                log(`üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${JSON.stringify(payload, null, 2)}`);
                
                // Get token from localStorage (for testing in admin app)
                let token = localStorage.getItem('authToken');
                if (!token) {
                    // Try alternative token storage
                    const authData = localStorage.getItem('auth');
                    if (authData) {
                        try {
                            const parsed = JSON.parse(authData);
                            token = parsed.token;
                        } catch (e) {
                            log('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô token ‡∏à‡∏≤‡∏Å localStorage');
                        }
                    }
                }
                
                if (!token) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö authentication token - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ login ‡∏Å‡πà‡∏≠‡∏ô');
                }
                
                log(`üîê ‡πÉ‡∏ä‡πâ token: ${token.substring(0, 20)}...`);
                
                const response = await fetch(`http://localhost:3001/api/v1/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(payload)
                });
                
                log(`üì° Response status: ${response.status}`);
                
                const data = await response.json();
                log(`üì• Response data: ${JSON.stringify(data, null, 2)}`);
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>‚úÖ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                            <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${data.data.firstName} ${data.data.lastName}</p>
                            <p><strong>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó:</strong> ${data.data.role}</p>
                            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${data.data.status}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>‚ùå ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</h3>
                            <p><strong>Error:</strong> ${data.error?.message || data.message}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        log('üöÄ ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        log('üìù ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö');
    </script>
</body>
</html>
